<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>15.3. 1-mic通话调试指引 &mdash; JL Project Documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../https://doc.zh-jieli.com/static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=fa47ad08"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="https://doc.zh-jieli.com/static/js/custom.js"></script>
        <script src="../../_static/js/custom.js?v=bfa33168"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="15.4. 2-mic通话调试指引" href="cvp_2mic_manual.html" />
    <link rel="prev" title="15.2. 清晰语音常用配置" href="cvp_common_config.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> JieLi_蓝牙音频
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SDK入门</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../framework/index.html">1. 技术框架</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/index.html">2. 快速入门</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SDK Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../earphone/index.html">1. 简介</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../audio/index.html">1. 音频播放</a></li>
<li class="toctree-l1"><a class="reference internal" href="../btstack/index.html">2. 蓝牙协议栈</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/index.html">3. 外设驱动</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/pmu/index.html">4. 电源管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pwm_led/index.html">5. LED状态显示</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/file_system/index.html">6. 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/os/index.html">7. 操作系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/timer/index.html">8. 定时器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/clock_manage/index.html">9. 时钟管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_manager/index.html">10. 设备管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6/index.html">11. 通用组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../audio_config/index.html">12. 音频配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../audio_flow/index.html">13. 音频流程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../audio_effects/index.html">14. 音效调试</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">15. 通话清晰语音</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cvp_algorithm_list.html">15.1. 清晰语音算法列表</a></li>
<li class="toctree-l2"><a class="reference internal" href="cvp_common_config.html">15.2. 清晰语音常用配置</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">15.3. <strong>1-mic</strong>通话调试指引</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">15.3.1. 功能介绍</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">15.3.1.1. 单mic清晰语音处理流程如下：</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">15.3.1.2. 远端和近端的定义</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id4">15.3.2. 使用说明</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">15.3.2.1. 回音算法选择</a></li>
<li class="toctree-l4"><a class="reference internal" href="#aec">15.3.2.2. 回音消除AEC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nlp">15.3.2.3. 非线性压制NLP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#agc">15.3.2.4. 自动增益控制AGC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">15.3.2.5. 降噪模式选择</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ans">15.3.2.6. 传统经典降噪ANS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dns">15.3.2.7. 神经网络降噪DNS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eq">15.3.2.8. 音质调节EQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">15.3.2.9. 噪声门-限幅</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#faq">15.3.3. 常见问题FAQ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id15">15.3.3.1. 有噪声或者电流声</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">15.3.3.2. 声音忽大忽小，不均匀</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">15.3.3.3. 回音消不掉</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">15.3.3.4. 远端听到的声音比较闷，不清晰</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">15.3.3.5. 远端听到的声音有尾音</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advance">15.3.3.6. 使用advance反而回音更加明显</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cvp_2mic_manual.html">15.4. <strong>2-mic</strong>通话调试指引</a></li>
<li class="toctree-l2"><a class="reference internal" href="cvp_2mic_hybrid_manual.html">15.5. <strong>2-mic hybrid</strong>通话调试指引</a></li>
<li class="toctree-l2"><a class="reference internal" href="cvp_3mic_manual.html">15.6. <strong>3-mic</strong>通话调试指引</a></li>
<li class="toctree-l2"><a class="reference internal" href="cvp_uart_data_export.html">15.7. 串口写卡使用指引</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../audio_FAQ/index.html">16. 音频FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/report/index.html">17. 系统状态报告</a></li>
<li class="toctree-l1"><a class="reference internal" href="../earphone_le_audio/index.html">18. LE_Audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1T2/index.html">19. 1T2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report/index.html">20. SDK测试报告</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">JieLi_蓝牙音频</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">15. </span>通话清晰语音</a> &raquo;</li>
      <li><span class="section-number">15.3. </span><strong>1-mic</strong>通话调试指引</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <!--
 * @Author: QiuHaihui qiuhaihui@zh-jieli.com
 * @Date: 2023-03-10 09:38:48
 * @LastEditors: QiuHaihui qiuhaihui@zh-jieli.com
 * @LastEditTime: 2023-04-23 09:31:29
 * @FilePath: \audio_cvp\cvp_1mic_manual.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
<section id="mic">
<h1><span class="section-number">15.3. </span><strong>1-mic</strong>通话调试指引<a class="headerlink" href="#mic" title="Link to this heading"></a></h1>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Date</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>V1.0</p></td>
<td><p>2023-04-23</p></td>
<td><p>初始版本</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>点击跳转 <a class="reference internal" href="../audio_flow/bt_call/bt_call_flow.html"><span class="std std-doc">通话算法节点配置说明</span></a></p></li>
</ul>
<section id="id1">
<h2><span class="section-number">15.3.1. </span>功能介绍<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<section id="id2">
<h3><span class="section-number">15.3.1.1. </span>单mic清晰语音处理流程如下：<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p><img alt="" src="../../_images/cvp_sms.png" /></p>
<p>注：降噪NS模块，可以选择传统降噪ANS，也可以选择神经网络降噪DNS，二选一。</p>
</section>
<section id="id3">
<h3><span class="section-number">15.3.1.2. </span>远端和近端的定义<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>以下是对于端对端通话过程远端和近端的定义，本手册涉及的远端近端概念，遵照以下框图：<br>
<img alt="" src="../../_images/call_ul_dl.png" /></p>
<p>  我们讨论的回音，是指远端手机讲话，发送到连接蓝牙设备的近端手机，然后声音从蓝牙设备的speaker发出来，又被蓝牙设备的microphone采集到，通过近端手机发送回远端手机，远端可以延时听到自己讲话的声音。</p>
</section>
</section>
<section id="id4">
<h2><span class="section-number">15.3.2. </span>使用说明<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<section id="id5">
<h3><span class="section-number">15.3.2.1. </span>回音算法选择<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p><img alt="" src="../../_images/cvp_sms_1.png" /></p>
<p>  根据样机的mic能采集到的回声大小，决定使用AEC_MODE_ADVANCE（AEC+NLP）还是AEC_MODE_REDUCE（NLP）。关闭算法，通话的时候，远端听到的回音大小，来判定回音大小。严谨的操作，可以通过远端录音，然后用音频分析软件看人声信号和回音的比例，即信回比SER，当SER小于20dB时，再考虑使用AEC_MODE_ADVANCE。</br>
  一般来说，音箱都需要使用AEC_MODE_ADVANCE，耳机方案的话优先使用AEC_MODE_REDUCE。AEC_MODE_REDUCE模式配合NLP模块参数的调试如果不能消除回声，再使用AEC_MODE_ADVANCE，advance模需要更多的内存和运算量。</br></p>
</section>
<section id="aec">
<h3><span class="section-number">15.3.2.2. </span>回音消除AEC<a class="headerlink" href="#aec" title="Link to this heading"></a></h3>
<p>AEC主要用来消除回音中的线性部分。参数设置如下：<br>
<img alt="" src="../../_images/cvp_sms_aec.png" /></p>
<ul class="simple">
<li><p><strong>AEC_EN</strong> : 是否使能回音消除模块</br></p></li>
<li><p><strong>AEC_DT_AGGRES</strong> : 原音追踪等级</br></p></li>
<li><p><strong>AEC_REFENGTHR</strong> : 进入回音消除参考值</br></p></li>
</ul>
<p>  AEC模块的参数基本不用调试，这里是为了兼容性考虑，所以放到配置工具。如有需要，由原开发人员指导修改。</p>
</section>
<section id="nlp">
<h3><span class="section-number">15.3.2.3. </span>非线性压制NLP<a class="headerlink" href="#nlp" title="Link to this heading"></a></h3>
<p>NLP主要用来消除回音中的非线性部分，参数设置如下：<br>
<img alt="" src="../../_images/cvp_sms_nlp.png" /></p>
<p>NLP模块根据回声的大小，进行相应的压制。</p>
<ul class="simple">
<li><p><strong>ES_AGGRESS_FACTOR</strong> ：回声侵略系数，该参数会根据回声大小进行动态自适应压制。</br></p></li>
<li><p><strong>ES_MIN_SUPPRESS</strong> : 回声压制最小压制阈值，偏向静态。</br>
<img alt="" src="../../_images/cvp_sms_nlp_1.png" /></p></li>
<li><p>调整步骤：</br>
(1)减小ES_AGGRESS_FACTOR，直到回声没有，或者有部分小回声泄露。</br>
(2)调整ES_MIN_SUPRESS，直到没有回声，该值影响双工效果。</br>
(3)测双工效果，如果双工效果不满意，则需要减少回声路径增益（减小ADC增益，或者减小DAC增益），并且恢复NLP_AGGRESS_FACTOR与NLP_SUPPRESS_FACTOR到默认系数，并回到步骤1。</br></p></li>
<li><p>调试Tips：</br>
  ES_AGGRESS_FACTOR参数是让算法自动调整，那如果在ES_AGGRESS_FACTOR比较小的情况下，还有小小的回声，这个时候建议调整ES_MIN_SUPPRESS，即以上步骤2。
  ES_MIN_SUPPRESS这个参数的副作用是越大，压制效果越明显，相应的，双工效果越差，甚至没有双工。具体数值根据实际样机的回声大小而定。</br></p></li>
</ul>
</section>
<section id="agc">
<h3><span class="section-number">15.3.2.4. </span>自动增益控制AGC<a class="headerlink" href="#agc" title="Link to this heading"></a></h3>
<section id="id6">
<h4><span class="section-number">15.3.2.4.1. </span>AGC参数配置说明<a class="headerlink" href="#id6" title="Link to this heading"></a></h4>
<p><img alt="" src="../../_images/cvp_agc.png" /></p>
<p>  AGC调试的是远端听到的声音。该模块是后级数字模块，即在一定的mic模拟增益的情况下，做完回音消除处理后，准备送到远端之前做的一个数字放大AGC。流程如下：
<img alt="" src="../../_images/cvp_agc_1.png" /></p>
<ul class="simple">
<li><p>调试Tips：</br>
(1)增益单位是dB；</br>
(2)当mic采集到的数据人声大于speech_thr（近端声音放大的阈值）时放大MAX_GAIN；</br>
(3)当mic采集到的数据人声小于等于speech_thr（近端声音放大的阈值）时放大MIN_GAIN；</br>
(4)最大放大倍数和最小放大倍数之间，是通过fade_in和fade_out来淡入淡出的。比如单端讲话，这个时候淡入的步进就是：ndt_fade_in，淡出的步进就是：ndt_fade_out。讲话的时候淡入，没说话的时候淡出。双端讲话则用dt_fade_in和dt_fade_out，用法一样；</br>
(5)speech_thr（近端声音放大的阈值）这个值根据mic采到的声音大小而定，如果太大，声音得不到均匀放大，即一会 放大max_gain，一会放大min_gain，听起来有可能忽大忽小。太小则有可能环境声也会一并放大。</br></p></li>
</ul>
</section>
<section id="id7">
<h4><span class="section-number">15.3.2.4.2. </span>AGC实现单工通话<a class="headerlink" href="#id7" title="Link to this heading"></a></h4>
<p>  在某些情况下，整个通话回路产生了严重失真，导致算法无法处理好回音，这个时候，就只能选择单工的通话方式。</br>
  所谓单工，即远端讲话的时候，听不到近端的声音，远端不讲话，可以听到近端的声音。而近端，什么时候都可以听到远端的声音。所以可以在检测到远端有说话，就开始将近端声音淡出，远端没说话，再自行淡入，就可以实现单工功能。</br>
<img alt="" src="../../_images/cvp_agc_2.png" /></p>
<p>  【注意】ECHO_PRESENT_THR 的值，决定什么时候进入单工处理。考虑到远端讲话的声音一般是比较大的，所以可以适当将该值设置高一点，避免远端环境声或者其他非目标声音稍微一大，就听不到近端声音。比如：远端过来的目标人声集中在-20dB到-40dB之间，则可以把ECHO_PRESENT_THR设置成-45dB。但是也要注意不能设置太大，太大会导致远端说话有些字达不到设定阈值，从而进入不了双端讲话模式，实现不了单工，出现漏回音的情况。</p>
</section>
</section>
<section id="id8">
<h3><span class="section-number">15.3.2.5. </span>降噪模式选择<a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<p>降噪模式有两种：传统经典降噪ANS和神经网络降噪DNS</p>
<p><img alt="" src="../../_images/cvp_ns_sel.png" /></p>
</section>
<section id="ans">
<h3><span class="section-number">15.3.2.6. </span>传统经典降噪ANS<a class="headerlink" href="#ans" title="Link to this heading"></a></h3>
<section id="id9">
<h4><span class="section-number">15.3.2.6.1. </span>通用参数说明<a class="headerlink" href="#id9" title="Link to this heading"></a></h4>
<p><img alt="" src="../../_images/cvp_sms_ans.png" /></p>
<p>注：降噪参数，推荐使用默认配置。如由需要调整，建议不要只调一个值，建议：</br>
  （1）如果要加强降噪效果，先调大一点动态压制ANS_AGGRESS，还不够，可以尝试调小一点静态压制ANS_SUPPRESS;</br>
  （2）如果要减弱降噪效果，先调大一点静态压制ANS_SUPPRESS，还不够，可以尝试调小一点动态压制ANS_AGGRESS。</br></p>
</section>
<section id="id10">
<h4><span class="section-number">15.3.2.6.2. </span>扩展参数说明<a class="headerlink" href="#id10" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><strong>ANS_NoiseLevel</strong> ：初始噪声水平</br>
  用来加速降噪收敛，跟mic信号的信噪比有关。Mic信号信噪比高，该值可以小一点，反之则需要稍微大一点。如果初始噪声设置过高，则可能导致一开始声音比较小声，如果过小，可能降噪收敛加速不明显。所以这个值需要具体方案如果出现以上可能问题时，适当修改。</br></p></li>
</ul>
</section>
</section>
<section id="dns">
<h3><span class="section-number">15.3.2.7. </span>神经网络降噪DNS<a class="headerlink" href="#dns" title="Link to this heading"></a></h3>
<p>神经网络降噪：收集大规模的干净语音和噪声数据集， 提取干净语音特征和带噪声语音特征，采用深度神经网络技术进行降噪模型的训练。训练出的降噪模型对输入信号实时进行噪声和语音的分类和回归，根据分类和回归的结果对语音信号进行噪声抑制，语音增强，提升信噪比。<br>
对比传统降噪算法，采用深度神经网络进行语音降噪和增强，噪声估计更准确，语音失真更小，同时也能适应非平稳噪声的降噪处理。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>降噪算法</p></th>
<th class="head"><p>优点</p></th>
<th class="head"><p>缺点</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ANS</p></td>
<td><p>对平稳噪声处理效果好，对ram和mips要求低</p></td>
<td><p>适应性差，对动态噪声处理效果欠佳</p></td>
</tr>
<tr class="row-odd"><td><p>DNS</p></td>
<td><p>噪声估计准确，语音保真度高，适应性好</p></td>
<td><p>对ram和mips要求高</p></td>
</tr>
</tbody>
</table>
<section id="id11">
<h4><span class="section-number">15.3.2.7.1. </span>通用参数说明<a class="headerlink" href="#id11" title="Link to this heading"></a></h4>
<p><img alt="" src="../../_images/cvp_sms_dns.png" /></br></p>
<ul class="simple">
<li><p><strong>DNS_GainFloor</strong>：增益平滑系数，该系数主要用于控制降噪增益最小值。如果降噪后底噪较大，可以适当减小该值；如果出现吃音问题，可以适当提高该值，建议设定范围：0.05 ~ 0.3。</br></p></li>
<li><p><strong>DNS_OverDrive</strong>：降噪强度控制，DNS_OverDrive=1为降噪中间值，即算法评估出来的降噪强度。大于1的时候，即为加强降噪强度，小于1的时候，即为降低降噪强度，建议调节范围：0.2 ~ 3 。</br></p></li>
</ul>
<p><img alt="" src="../../_images/cvp_sms_dns_1.png" /></p>
</section>
<section id="id12">
<h4><span class="section-number">15.3.2.7.2. </span>扩展参数说明<a class="headerlink" href="#id12" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><strong>DNS_NoiseLevel</strong>：初始噪声水平，用来加速降噪收敛，跟mic信号的信噪比有关。Mic信号信噪比高，该值可以小一点，反之则需要稍微大一点。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>如果初始噪声设置过高，则可能导致一开始声音比较小声，如果过小，可能降噪收敛加速不明显。所以这个值需要具体方案如果出现以上可能问题时，适当修改。
</pre></div>
</div>
</section>
<section id="id13">
<h4><span class="section-number">15.3.2.7.3. </span>常见问题调试指引<a class="headerlink" href="#id13" title="Link to this heading"></a></h4>
<p>（1）出现吃音或者一句话某个字某个字变得很小声问题</br>
  出现该问题时，首先要确认所处环境 是不是信噪比很低(如小于-5dB)，即噪声比人声大很多，这种情形下，优化空间有限，调试步骤如下：</br></p>
<ul class="simple">
<li><p>步骤1：通过调节mic的增益来缓解：如果mic的增益比较小(小于10dB)，可以适当提高mic增益来缓解吃音问题，建议调节范围不要超过15dB；提高mic增益可能会导致噪声增大，据实际情况调节。</br></p></li>
<li><p>步骤2：调节DNS_GainFloor和DNS_OverDrive参数：适当提高DNS_GainFloor 或 适当减小 DNS_OverDrive，可以通过配合gain_floor和over_drive适度调节。</br></p></li>
</ul>
<p>（2）远端听到声音不均匀，忽大忽小</br>
  如果后处理开启了AGC模块，出现该问题时，请参照“章节十：常见问题FAQ”第二个问题进行确认调整。</br></p>
</section>
</section>
<section id="eq">
<h3><span class="section-number">15.3.2.8. </span>音质调节EQ<a class="headerlink" href="#eq" title="Link to this heading"></a></h3>
<p><img alt="" src="../../_images/cvp_sms_eq.png" /></p>
<p>  考虑到有些MIC物理特性，或者腔体声学设计缺陷，导致MIC采集到的声音比较低沉，这种情况可以适当的对声音做EQ处理。通话的EQ通常最多3段，就可以基本满足需求。具体什么EQ参数合适，根据实际情景进行配置。场景情景如下：</br></p>
<ul class="simple">
<li><p>情景1：声音低沉，闷，不够透亮</br>
（1）适当提高MIC的模拟增益；</br>
（2）使用high-pass的滤波器做简单的处理，低频适当衰减。</br></p></li>
<li><p>情景2：声音听起来有唇齿音</br>
如果使用msbc，有些mic灵敏度比较高，MIC可以采到6.8k左右的唇齿音，如果介意，这个时候可以做一个high-shelf的滤波器处理。</br></p></li>
</ul>
</section>
<section id="id14">
<h3><span class="section-number">15.3.2.9. </span>噪声门-限幅<a class="headerlink" href="#id14" title="Link to this heading"></a></h3>
<p>  用于限制下行近端声音的最大幅度，防止声音爆掉；同时在下行近端声音较小时候，衰减声音幅度，用于压制没有声音时候的底噪。</p>
<ul class="simple">
<li><p><strong>dl_limiter</strong> : 噪声门-限幅的开关</p></li>
<li><p><strong>limiter_thr</strong> : 限幅器阈值，限制下行近端声音的最大幅度</p></li>
<li><p><strong>limiter_noise_gate</strong> : 噪声门阈值，当声音小于limiter_noise_gate的时候，声音会被衰减，衰减大小由limiter_noise_gain的大小决定；</p></li>
<li><p><strong>limiter_noise_gain</strong> ：噪声衰减系数，当声音小于limiter_noise_gate的时候，声音会被衰减，衰减大小由limiter_noise_gain的大小决定，数值越小，声音衰减越多</p></li>
</ul>
</section>
</section>
<section id="faq">
<h2><span class="section-number">15.3.3. </span>常见问题FAQ<a class="headerlink" href="#faq" title="Link to this heading"></a></h2>
<section id="id15">
<h3><span class="section-number">15.3.3.1. </span>有噪声或者电流声<a class="headerlink" href="#id15" title="Link to this heading"></a></h3>
<p>  关闭回音消除，听mic的原始声音是否有噪声或者电流声，如果有，则优先处理源头的噪声,因为干扰声会 严重影响通话效果。可以做以下尝试：</br>
（1）通话的时候切换成LDO</br>
（2）降低发射功率</br>
如果以上操作无效，再检查pcb是否合理</br></p>
</section>
<section id="id16">
<h3><span class="section-number">15.3.3.2. </span>声音忽大忽小，不均匀<a class="headerlink" href="#id16" title="Link to this heading"></a></h3>
<p>（1）AGC放大参数是否合理（详细参考本文档“自动增益控制AGC”章节）</br>
由于mic灵敏度差异，这里可以讲max_gain和min_gain设置成一样，确认是否是AGC原因：</br>
<img alt="" src="../../_images/cvp_agc_3.png" /></p>
<p>  改完如果正常，则逐步加小相应的阈值SPEECH_THR，小于该阈值的当成噪声不放大。</br>
  改完依旧不正常可能是“ANS参数设置不合理”。</br>
（2）ANS参数是否合理</br>
  如果mic本身（或者由于电路干扰）采到的声音信噪比比较低，经过降噪模块，则可能会损耗比较多的人声部分，说话小声的部分会变得比较小声。这个时候可以参数减弱ANS的强度，优先调ANS_Suppress，步进不要超过0.1。注意不要调太弱，降噪太弱，声音听起来也会不那么干净。</br>
如果当前没有回音问题，也可以尝试提高一些mic的增益，提高声音信噪比，提高ANS的降噪空间，再尝试通话，根据文档解决剩下的问题。</br></p>
</section>
<section id="id17">
<h3><span class="section-number">15.3.3.3. </span>回音消不掉<a class="headerlink" href="#id17" title="Link to this heading"></a></h3>
<p>（1）使用aec高级模式(AEC+NLP)</p>
<p>（2）硬件检查</p>
<ul class="simple">
<li><p>A.查看各个电源配置电压差是否满足要求，</p></li>
<li><p>B.排查是不是硬件干扰过去的回音:可以将喇叭or麦换成等效电阻，AEC_MODE选择disable，如果这时候还存在回声，可能回音有部分来自于硬件的电路干扰，严重程度听回音大小。
如果暂时无法修改硬件环境，可通过降低DAC增益或者MIC增益，减小回音程度。</p></li>
</ul>
</section>
<section id="id18">
<h3><span class="section-number">15.3.3.4. </span>远端听到的声音比较闷，不清晰<a class="headerlink" href="#id18" title="Link to this heading"></a></h3>
<p>（1）确认麦的供电是否满足要求</br>
  具体查看的麦对应的datasheet关于电源的供电范围说明，调整偏置电压到合适的范围内。</br>
（2）大声或者对着麦克风说话，看是否有改善</br>
  如果有，则考虑MIC的增益设置不合理，加大MIC增益试试。</br>
（3）拆开样机外壳，试听声音效果</br>
  如果拆开样机外壳，声音明显改善，则怀疑是MIC的是声学设计影响了拾音效果。</br></p>
<ul class="simple">
<li><p>注1：MIC和外壳孔隙尽量小，有MIC套防震处理</p></li>
<li><p>注2：MIC开孔朝向尽量对着发声源（嘴巴）</p></li>
<li><p>注3：MIC内部有独立腔体，减少声音回荡抵消部分频率成分</p></li>
</ul>
<p>（4）声音大，不清晰，浑浊</br>
录制MIC原始信号（通过spp导出或者关闭算法，远端手机录音），分析具体的MIC信号频率成分（频响/频谱），注意底噪情况。使用EQ模块，对声音进行修饰处理：</br></p>
<p>  一般处理是加一段高通处理，常用是100~200Hz截止。如果中高频不够，再加一个带通处理，比如800到1200H的增强处理。</br></p>
</section>
<section id="id19">
<h3><span class="section-number">15.3.3.5. </span>远端听到的声音有尾音<a class="headerlink" href="#id19" title="Link to this heading"></a></h3>
<p>  （1）可能mic本身（或者由于电路干扰）采到的声音信噪比比较低，目前的ANS参数无法压制mic的噪声，可以调整ANS参数（详细参考本文档“ANS参数”章节）。</br>
  （2）如果调节ANS参数会带来忽大忽小问题，那么还原ANS参数。降低AGC的效果，逐步减小相应的放大上限MAX_GAIN，至声音比较干净，再轻微提高MIC的增益，对声音的大小进行补偿。</br>
<img alt="" src="../../_images/cvp_agc_4.png" /></p>
</section>
<section id="advance">
<h3><span class="section-number">15.3.3.6. </span>使用advance反而回音更加明显<a class="headerlink" href="#advance" title="Link to this heading"></a></h3>
<p>  当回音本来就很小的时候，如果打开了advance（AEC+NLP），即使能了AEC_EN，有可能近端说话的时候，干扰到回音处理，导致回音非但没有消除，反而变大的情况。这种可以先把算法直接disable，判断回音大小。如果回音不明显，就使用reduce，即NLP_EN + ANS_EN，再优化参数。</br></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cvp_common_config.html" class="btn btn-neutral float-left" title="15.2. 清晰语音常用配置" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cvp_2mic_manual.html" class="btn btn-neutral float-right" title="15.4. 2-mic通话调试指引" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010-2023, 杰理科技股份有限公司.
      <span class="lastupdated">Last updated on Oct 08, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>